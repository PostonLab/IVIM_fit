{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"IVIM_fit","text":"<p>Preprocessing diffusion MRI data and fitting IVIM models</p>"},{"location":"#how-to-use-locally","title":"How to use locally:","text":"<ol> <li>Clone the repository in Sherlock using <code>git clone https://github.com/PostonLab/IVIM_fit.git</code>. <code>cd</code> into the cloned repository, then <code>cd</code> into the ivim_fit directory within the repository. You should see a <code>run.py</code> file there. <pre><code>git clone https://github.com/PostonLab/IVIM_fit.git\n</code></pre> <pre><code>cd ivim_fit\n</code></pre></li> <li>Install poetry version 1.8.5 using <code>python3 -m pip install poetry==1.8.5</code> <pre><code>python3 -m pip install poetry==1.8.5\n</code></pre></li> <li>Install dependencies with <code>poetry install</code>, then use <code>poetry shell</code> to activate the virtual environment. <pre><code>poetry install\n</code></pre> <pre><code>poetry shell\n</code></pre></li> <li>First run the workflow dry-run with python <code>./run.py &lt;path to bids data&gt; &lt;path to output&gt; participant -np</code>. <pre><code>./run.py &lt;insert path to your bids data&gt; &lt;insert path to your output&gt; participant -np\n</code></pre></li> <li>If the dry run is successful, we can run the workflow with <code>python ./run.py &lt;path to bids data&gt; &lt;path to output&gt; participant -c all --use-singularity</code>. Where <code>-c</code> is for number of cores you want to use. <code>all</code> will use everything available. <pre><code>python ./run.py &lt;path to bids data&gt; &lt;path to output&gt; participant -c all --use-singularity\n</code></pre></li> <li>When running for the first time, it will install all the singularity containers.</li> </ol>"},{"location":"#how-to-run-in-sherlock-cluster-at-stanford","title":"How to run in Sherlock cluster at Stanford:","text":"<ol> <li>Clone the repository in Sherlock using <code>git clone https://github.com/PostonLab/IVIM_fit.git</code>. <code>cd</code> into the cloned repository, then <code>cd</code> into the ivim_fit directory within the repository. You should see a <code>run.py</code> file there. <pre><code>git clone https://github.com/PostonLab/IVIM_fit.git\n</code></pre> <pre><code>cd ivim_fit\n</code></pre> (If you see the error: <code>fatal: unable to access 'https://github.com/PostonLab/IVIM_fit.git/': error setting certificate verify locations:  CAfile: /etc/ssl/certs/ca-certificates.crt CApath: none</code>, first manually point git to the CA bundle with <code>git config --global http.sslCAInfo /etc/ssl/certs/ca-bundle.crt</code>, then try <code>git clone</code> again.)  <pre><code>git config --global http.sslCAInfo /etc/ssl/certs/ca-bundle.crt\n</code></pre></li> <li>Activate an interractive shell using <code>salloc</code> <pre><code>salloc\n</code></pre></li> <li>Load python3 using <code>ml python/3.9.0</code> <pre><code>ml python/3.9.0\n</code></pre></li> <li>Create a python environment <code>python3.9 -m venv &lt;name&gt;</code> <pre><code>python3.9 -m venv &lt;name&gt;\n</code></pre></li> <li>Activate the environment <code>source &lt;venv_name&gt;/bin/activate</code> <pre><code>source &lt;venv_name&gt;/bin/activate\n</code></pre></li> <li>Install dependencies with <code>poetry install</code>. [If poetry version 1.8.5 is not already installed, install it using <code>python3 -m pip install poetry==1.8.5</code>, then rerun <code>poetry install</code> (recommended), or <code>wget -O - https://install.python-poetry.org | python3 - --version 1.8.5</code>]. If needed install six package using <code>python3 -m pip install six</code>) <pre><code>poetry install\n</code></pre> If poetry not already installed:<pre><code>python3 -m pip install poetry==1.8.5\n</code></pre></li> <li>Deactivate the existing python environment using <code>deactivate</code>. Then use <code>poetry shell</code> to activate the new ivim virtual environment. <pre><code>deactivate\n</code></pre> <pre><code>poetry shell\n</code></pre></li> <li>Navigate to <code>ivim_fit</code> directory using <code>cd ivim_fit</code> where you will see the <code>run.py</code> file. <pre><code>cd ivim_fit\n</code></pre></li> <li>First run the workflow dry-run with <code>python ./run.py &lt;path to bids data&gt; &lt;path to output&gt; participant -np</code>. <pre><code>python ./run.py &lt;path to bids data&gt; &lt;path to output&gt; participant -np\n</code></pre></li> <li>If the dry run is successful, we can run the workflow with <code>python ./run.py &lt;path to bids data&gt; &lt;path to output&gt; participant -c all --use-singularity</code>. Where <code>-c</code> is for number of cores you want to use. <code>all</code> will use everything available. <pre><code>python ./run.py &lt;path to bids data&gt; &lt;path to output&gt; participant -c all --use-singularity\n</code></pre></li> <li>If running again, first load python 3.9 using <code>ml python/3.9.0</code>, and then run <code>poetry shell</code> to activae the python environment. <pre><code>ml python/3.9.0\n</code></pre> <pre><code>poetry shell\n</code></pre></li> </ol>"},{"location":"#how-to-contribute","title":"How to contribute:","text":"<ol> <li>Clone the repository with <code>git clone https://github.com/PostonLab/IVIM_fit.git</code> <pre><code>git clone https://github.com/PostonLab/IVIM_fit.git\n</code></pre></li> <li>Checkout a branch and make changes.</li> <li>Before doing <code>git add .</code>, run <code>poe quality</code>. This will automatically run formatting and make necessary changes.</li> <li>If everything looks pretty, proceed with pushing changes.</li> <li>Go to github and make a pull request for your changes.</li> </ol>"},{"location":"#acknowledgement","title":"Acknowledgement","text":"<p>This project utilizes code adapted from the snakedwi pipeline ([https://github.com/akhanf/snakedwi]), an open-source project for diffusion MRI preprocessing. Their work provided a valuable foundation for building the preprocessing steps of IVIM_fit pipeline.</p>"},{"location":"getting_started/installation/","title":"Installation","text":""},{"location":"getting_started/installation/#installation","title":"Installation","text":"<p>Install from github with pip:</p> <pre><code>pip install -e git+https://github.com/dimuthuhemachandra/ivim_fit#egg=ivim_fit\n</code></pre> <p>Note: you can re-run this command to re-install with the latest version</p>"},{"location":"getting_started/installation/#running-the-app","title":"Running the app","text":"<p>Do a dry-run first (<code>-n</code>) and simply print (<code>-p</code>) what would be run:</p> <pre><code>ivim_fit /path/to/bids/dir /path/to/output/dir participant -np\n</code></pre> <p>Run the app, using all cores::</p> <pre><code>ivim_fit /path/to/bids/dir /path/to/output/dir participant --cores all\n</code></pre> <p>If any workflow rules require containers, then run with the <code>--use-singularity</code> option.</p>"},{"location":"getting_started/installation/#generating-a-report","title":"Generating a report","text":"<p>After your processing is complete, you can use snakemake's <code>--report</code> feature to generate an HTML report. This report will include a graph of all the jobs run, with clickable nodes to inspect the shell command or python code used in each job, along with the config files and run times for each job. Workflows may also contain append images for quality assurance or to summarize outputs, by using the <code>report(...)</code> function on any snakemake output.</p> <p>To generate a report, run:</p> <pre><code>ivim_fit /path/to/bids/dir /path/to/output/dir participant --report\n</code></pre>"},{"location":"getting_started/installation/#compute-canada-instructions","title":"Compute Canada Instructions","text":""},{"location":"getting_started/installation/#setting-up-a-dev-environment","title":"Setting up a dev environment","text":"<p>Here are some instructions to get your python environment set-up on graham to run ivim_fit:</p>"},{"location":"getting_started/installation/#create-a-virtualenv-and-activate-it","title":"Create a virtualenv and activate it:","text":"<pre><code>cd $SCRATCH\nmodule load python/3\nvirtualenv venv_ivim_fit\nsource venv_ivim_fit/bin/activate\n</code></pre>"},{"location":"getting_started/installation/#follow-the-steps-above-to-install-from-github-repository","title":"Follow the steps above to install from github repository","text":""},{"location":"getting_started/installation/#install-job-submission-helpers","title":"Install job submission helpers","text":"<p>Snakemake can submit jobs with SLURM, but you need to set-up a Snakemake profile to enable this. The Khan lab has a snakemake profile that is configured for graham but is customizable upon install, please see <code>cc-slurm &lt;https://github.com/khanlab/cc-slurm&gt;</code> for more info.</p> <p>If you don't need Snakemake to parallelize jobs across different nodes, you can make use of the simple job submission wrappers in <code>neuroglia-helpers &lt;https://github.com/khanlab/neuroglia-helpers&gt;</code>, e.g. <code>regularSubmit</code> or <code>regularInteractive</code> wrappers.</p> <p>These are used in the instructions below.</p>"},{"location":"getting_started/installation/#running-jobs-on-compute-canada","title":"Running jobs on Compute Canada","text":"<p>In an interactive job (for testing):</p> <pre><code>regularInteractive -n 8 ivim_fit bids_dir out_dir participant --participant_label 001 -j 8\n</code></pre> <p>Submitting a job (for larger cores, more subjects), still single job, but snakemake will parallelize over the 32 cores:</p> <pre><code>regularSubmit -j Fat ivim_fit bids_dir out_dir participant  -j 32\n</code></pre> <p>Scaling up to ~hundred subjects (needs cc-slurm snakemake profile installed), submits 1 16core job per subject:</p> <pre><code>ivim_fit bids_dir out_dir participant  --profile cc-slurm\n</code></pre> <p>Scaling up to even more subjects (uses group-components to bundle multiple subjects in each job), 1 32core job for N subjects (e.g. 10):</p> <pre><code>ivim_fit bids_dir out_dir participant  --profile cc-slurm --group-components subj=10\n</code></pre>"},{"location":"usage/app_cli/","title":"App cli","text":""},{"location":"usage/app_cli/#command-line-interface","title":"Command line interface","text":"<pre><code>:filename: ../ivim_fit/run.py\n:func: get_parser\n:prog: ivim_fit\n</code></pre>"},{"location":"usage/snakemake_cli/","title":"Snakemake cli","text":""},{"location":"usage/snakemake_cli/#snakemake-command-line-interface","title":"Snakemake Command line interface","text":"<pre><code>:module: snakemake\n:func: get_argument_parser\n:prog: snakemake\n</code></pre>"}]}